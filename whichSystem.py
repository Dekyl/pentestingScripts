#!/usr/bin/python3

from pwn import *

if __name__ == "__main__":

    if len(sys.argv) != 2:
        print("\nNumber of arguments invalid.\n\npython3 " + sys.argv[0] + " <IP target>\n")
        sys.exit(1)

    try:
        ip = sys.argv[1]

        response = subprocess.Popen(
            ['ping', '-c', '1', ip], stdout=subprocess.PIPE)

        (out, err) = response.communicate()

        out = out.split()
        ttl = out[12].decode('utf-8')
        ttl = ttl[4:6]
        ttl = int(ttl)

        if ttl >= 0 and ttl <= 64:
            os = "Linux"
        elif ttl > 64 and ttl <= 128:
            os = "Windows"
        else:
            os = "Not found"

        print("\n%s (ttl=%s) -> %s machine" % (ip, ttl, os))

    except Exception as e:
        log.error(str(e))
